<!-- src/app/features/presupuestos/listado-presupuestos/listado-presupuestos.component.html -->
<div class="page">
  <div class="page-header">
    <h1>Presupuestos</h1>
    <div class="actions">
      <button *ngIf="auth.canEdit()" class="btn-primary" (click)="nuevo()">Nuevo presupuesto</button>
      <a routerLink="/productos" class="btn-secondary">Volver a productos</a>
    </div>
  </div>

  <div class="search-bar">
    <input [(ngModel)]="q" placeholder="Buscar por cliente/estado/ID" (keyup.enter)="buscar()">
    <button class="btn-primary" (click)="buscar()">Buscar</button>
  </div>

  <div *ngIf="loading" class="muted">Cargandoâ€¦</div>
  <div *ngIf="!loading && error" class="error">{{ error }}</div>
  <div *ngIf="!loading && !data.length" class="muted">Sin resultados</div>

  <table *ngIf="!loading && data.length">
    <thead>
      <tr>
        <th style="width:80px;">ID</th>
        <th>Cliente</th>
        <th style="width:140px;">Estado</th>
        <th class="text-end" style="width:150px;">Total</th>
        <th style="width:180px;">Creado</th>
        <th class="text-end" style="width:280px;">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of data">
        <td>{{ p.id }}</td>
        <td>{{ p.cliente?.nombre || '-' }}</td>
        <td>
          <span class="badge"
            [class.success]="p.estado==='confirmado'"
            [class.warn]="p.estado==='borrador'"
            [class.danger]="p.estado==='cancelado'">
            {{ p.estado }}
          </span>
        </td>
        <td class="text-end">{{ p.total | number:'1.2-2' }}</td>
        <td>{{ p.created_at | date:'short' }}</td>
        <td class="text-end">
          <a class="btn-accion gray" (click)="editar(p.id)">Editar</a>
          <a *ngIf="auth.canDelete()" class="btn-accion red" (click)="eliminar(p.id)">Eliminar</a>
        </td>
      </tr>
    </tbody>
  </table>
</div>
